/*! canvas-toy 2016-07-04 */
!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define(b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){b.glMatrix=c(1),b.mat2=c(2),b.mat2d=c(3),b.mat3=c(4),b.mat4=c(5),b.quat=c(6),b.vec2=c(9),b.vec3=c(7),b.vec4=c(8)},function(a,b){var c={};c.EPSILON=1e-6,c.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,c.RANDOM=Math.random,c.ENABLE_SIMD=!1,c.SIMD_AVAILABLE=c.ARRAY_TYPE===Float32Array&&"SIMD"in this,c.USE_SIMD=c.ENABLE_SIMD&&c.SIMD_AVAILABLE,c.setMatrixArrayType=function(a){c.ARRAY_TYPE=a};var d=Math.PI/180;c.toRadian=function(a){return a*d},a.exports=c},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},a.exports=e},function(a,b,c){var d=c(1),e={scalar:{},SIMD:{}};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.SIMD.transpose=function(a,b){var c,d,e,f,g,h,i,j,k,l;return c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12),g=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),i=SIMD.Float32x4.shuffle(g,h,0,2,4,6),j=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,0,i),SIMD.Float32x4.store(a,4,j),g=SIMD.Float32x4.shuffle(c,d,2,3,6,7),h=SIMD.Float32x4.shuffle(e,f,2,3,6,7),k=SIMD.Float32x4.shuffle(g,h,0,2,4,6),l=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,8,k),SIMD.Float32x4.store(a,12,l),a},e.transpose=d.USE_SIMD?e.SIMD.transpose:e.scalar.transpose,e.scalar.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.SIMD.invert=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=SIMD.Float32x4.load(b,0),n=SIMD.Float32x4.load(b,4),o=SIMD.Float32x4.load(b,8),p=SIMD.Float32x4.load(b,12);return g=SIMD.Float32x4.shuffle(m,n,0,1,4,5),d=SIMD.Float32x4.shuffle(o,p,0,1,4,5),c=SIMD.Float32x4.shuffle(g,d,0,2,4,6),d=SIMD.Float32x4.shuffle(d,g,1,3,5,7),g=SIMD.Float32x4.shuffle(m,n,2,3,6,7),f=SIMD.Float32x4.shuffle(o,p,2,3,6,7),e=SIMD.Float32x4.shuffle(g,f,0,2,4,6),f=SIMD.Float32x4.shuffle(f,g,1,3,5,7),g=SIMD.Float32x4.mul(e,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.mul(d,g),i=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,g),h),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),g=SIMD.Float32x4.mul(d,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),h),k=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),g=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),e=SIMD.Float32x4.swizzle(e,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),h),j=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),j),j=SIMD.Float32x4.swizzle(j,2,3,0,1),g=SIMD.Float32x4.mul(c,d),g=SIMD.Float32x4.swizzle(g,1,0,3,2),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,g),k),g=SIMD.Float32x4.swizzle(g,2,3,0,1),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(e,g)),g=SIMD.Float32x4.mul(c,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),j),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),i),j=SIMD.Float32x4.sub(j,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.mul(c,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),i),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),k),l=SIMD.Float32x4.mul(c,h),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),g=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(g,g),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(g,g))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(l,i)),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(l,j)),SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(l,k)),a):null},e.invert=d.USE_SIMD?e.SIMD.invert:e.scalar.invert,e.scalar.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.SIMD.adjoint=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12);return k=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),g=SIMD.Float32x4.shuffle(k,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,k,1,3,5,7),k=SIMD.Float32x4.shuffle(c,d,2,3,6,7),j=SIMD.Float32x4.shuffle(e,f,2,3,6,7),i=SIMD.Float32x4.shuffle(k,j,0,2,4,6),j=SIMD.Float32x4.shuffle(j,k,1,3,5,7),k=SIMD.Float32x4.mul(i,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.mul(h,k),m=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,k),l),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),k=SIMD.Float32x4.mul(h,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),l),o=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),l),n=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),n),n=SIMD.Float32x4.swizzle(n,2,3,0,1),k=SIMD.Float32x4.mul(g,h),k=SIMD.Float32x4.swizzle(k,1,0,3,2),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,k),o),k=SIMD.Float32x4.swizzle(k,2,3,0,1),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(i,k)),k=SIMD.Float32x4.mul(g,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),n),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),m),n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.mul(g,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),m),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),o),SIMD.Float32x4.store(a,0,l),SIMD.Float32x4.store(a,4,m),SIMD.Float32x4.store(a,8,n),SIMD.Float32x4.store(a,12,o),a},e.adjoint=d.USE_SIMD?e.SIMD.adjoint:e.scalar.adjoint,e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4.load(c,0),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),g))));SIMD.Float32x4.store(a,0,i);var j=SIMD.Float32x4.load(c,4),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,3,3,3,3),g))));SIMD.Float32x4.store(a,4,k);var l=SIMD.Float32x4.load(c,8),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),g))));SIMD.Float32x4.store(a,8,m);var n=SIMD.Float32x4.load(c,12),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),g))));return SIMD.Float32x4.store(a,12,o),a},e.scalar.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.multiply=d.USE_SIMD?e.SIMD.multiply:e.scalar.multiply,e.mul=e.multiply,e.scalar.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.SIMD.translate=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]),d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(h,0,0,0,0)),e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(h,1,1,1,1)),f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(h,2,2,2,2));var i=SIMD.Float32x4.add(d,SIMD.Float32x4.add(e,SIMD.Float32x4.add(f,g)));return SIMD.Float32x4.store(a,12,i),a},e.translate=d.USE_SIMD?e.SIMD.translate:e.scalar.translate,e.scalar.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.SIMD.scale=function(a,b,c){var d,e,f,g=SIMD.Float32x4(c[0],c[1],c[2],0);return d=SIMD.Float32x4.load(b,0),SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,0,0,0,0))),e=SIMD.Float32x4.load(b,4),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(g,1,1,1,1))),f=SIMD.Float32x4.load(b,8),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,2,2,2,2))),a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.scale=d.USE_SIMD?e.SIMD.scale:e.scalar.scale,e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.scalar.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,4),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateX=d.USE_SIMD?e.SIMD.rotateX:e.scalar.rotateX,e.scalar.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,d),SIMD.Float32x4.mul(g,e))),a},e.rotateY=d.USE_SIMD?e.SIMD.rotateY:e.scalar.rotateY,e.scalar.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.SIMD.rotateZ=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,4);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateZ=d.USE_SIMD?e.SIMD.rotateZ:e.scalar.rotateZ,e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},a.exports=e},function(a,b,c){var d=c(1),e=c(4),f=c(7),g=c(8),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return-.999999>i?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;
return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.exports=h},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},a.exports=e}])});var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},CanvasToy;!function(a){a.debug=!0}(CanvasToy||(CanvasToy={})),CanvasToy.glMatrix=glMatrix,CanvasToy.vec2=vec2,CanvasToy.vec3=vec3,CanvasToy.vec4=vec4,CanvasToy.mat2=mat2,CanvasToy.mat2d=mat2d,CanvasToy.mat3=mat3,CanvasToy.mat4=mat4,CanvasToy.quat=quat;var CanvasToy;!function(a){var b=function(){function a(a){this.positions=[],this.uvs=[],this.normals=[],this.indices=[]}return a.prototype.addVertex=function(a,b,c,d){this.indices.push.apply(a),this.positions.push.apply(b),c?this.uvs.push.apply(c):0,d?this.normals.push.apply:0},a}();a.Geometry=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(b,c){var d=this;this.textureCoord=[],this.isReadyToUpdate=!1,this.image=new Image;var e=a.engine.gl;this.glTexture=e.createTexture(),this.image.src=b,this.image.onload=function(){d.isReadyToUpdate=!0,console.log("texture loaded")}}return b}();a.Texture=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){a.colors={white:a.vec4.fromValues(1,1,1,1),black:a.vec4.fromValues(0,0,0,1),gray:a.vec4.fromValues(.5,.5,.5,1),red:a.vec4.fromValues(1,0,0,1)},function(a){a[a.flatShading=0]="flatShading",a[a.smoothShading=1]="smoothShading"}(a.ShadingMode||(a.ShadingMode={}));var b=a.ShadingMode,c=function(){function c(){this.attributes={},this.uniforms={},this.samplers={},this.ambient=a.vec3.fromValues(.1,.1,.1),this.diffuse=a.vec3.fromValues(.8,.8,.8),this.specular=a.vec3.fromValues(1,1,1),this.opacity=a.vec3.fromValues(0,0,0),this.shadingMode=b.smoothShading}return c.prototype.addAttribute=function(a,b){this.attributes[a]=b},c.prototype.addUniform=function(a,b){this.uniforms[a]=b},c}();a.Material=c}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(){this.updateEvents=[],this.startEvents=[],this.modelViewMatrix=a.mat4.create(),this.translate(0,0,0),this.matrix=a.mat4.create(),this.position=a.vec4.create(),this.size=a.vec3.create()}return b.prototype.registerUpdate=function(a){this.updateEvents.push(a)},b.prototype.registerStart=function(a){this.startEvents.push(a)},b.prototype.start=function(){for(var a=0,b=this.startEvents;a<b.length;a++){var c=b[a];c()}},b.prototype.update=function(a){for(var b=0,c=this.updateEvents;b<c.length;b++){var d=c[b];d(a)}},b.prototype.translate=function(b,c,d){this.modelViewMatrix=a.mat4.translate(a.mat4.create(),this.modelViewMatrix,a.vec3.fromValues(b,c,d))},b.prototype.translateTo=function(a,b,c){},b.prototype.rotateX=function(b){this.modelViewMatrix=a.mat4.rotateX(a.mat4.create(),this.modelViewMatrix,b)},b.prototype.rotateY=function(b){this.modelViewMatrix=a.mat4.rotateY(a.mat4.create(),this.modelViewMatrix,b)},b.prototype.rotateZ=function(b){this.modelViewMatrix=a.mat4.rotateZ(a.mat4.create(),this.modelViewMatrix,b)},b.prototype.scale=function(b,c,d){if(void 0==c)var c=b;if(void 0==d)var d=b;this.modelViewMatrix=a.mat4.scale(a.mat4.create(),this.modelViewMatrix,a.vec3.fromValues(b,c,d))},b}();a.Object3d=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(){b.call(this),this.parent=null,this.children=[],this.relativeMatrix=a.mat4.create()}return __extends(c,b),c.prototype.addChild=function(a){this.children.push(a),a.parent=this},c.prototype.compuseMatrixs=function(){var b=this.parent.matrix;this.modelViewMatrix=a.mat4.mul(a.mat4.create(),this.relativeMatrix,b);for(var c=0,d=this.children;c<d.length;c++){var e=d[c];e.compuseMatrixs()}},c}(a.Object3d);a.Node=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(){this.uniforms={},this.uniformUpdaters={},this.attributes={},this.drawMode=a.engine.gl.STATIC_DRAW,this.vertexBuffers={}}return b.prototype.Program=function(b){this.uniforms=b.uniforms,this.attributes=b.attributes;for(var c in b.uniforms)this.uniforms[c]=a.engine.getUniformLocation(this,c);for(var d=0,e=b.attributes;d<e.length;d++){var f=e[d];f.index=a.engine.gl.getAttribLocation(this,name),this.vertexBuffers[name]=f}},b.prototype.setAttribute0=function(b){return this.attribute0=b,this.attribute0.index=0,this.vertexBuffers[b.name]=b,a.engine.gl.bindAttribLocation(this.webGlProgram,0,this.attribute0.name),b},b.prototype.addAttribute=function(b){return b.index=a.engine.gl.getAttribLocation(this.webGlProgram,b.name),this.vertexBuffers[b.name]=b,b},b.prototype.addUniform=function(b,c){a.engine.gl.useProgram(this.webGlProgram),this.uniforms[b]=a.engine.getUniformLocation(this,b),this.uniformUpdaters[b]=c},b}();a.Program=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(c,d){var e=this;b.call(this),this.drawMode=a.engine.gl.STATIC_DRAW,this.maps=[],this.normalMatrix=a.mat4.create(),this.material=d,this.geometry=c,this.registerUpdate(function(b){a.mat4.transpose(e.normalMatrix,a.mat4.invert(a.mat4.create(),e.modelViewMatrix))})}return __extends(c,b),c}(a.Node);a.Mesh=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(){var b=this;this.objects=[],this.lights=[],this.ambientLight=a.vec3.fromValues(0,0,0),this.openLight=!0,this.enableShadowMap=!1,this.clearColor=[0,0,0,0],window.setInterval(function(){return b.update(1e3/60)},1e3/60)}return b.prototype.update=function(a){for(var b=0,c=this.objects;b<c.length;b++){var d=c[b];d.update(a)}},b.prototype.addObject=function(a){this.objects.push(a),a.scene=this},b.prototype.addLight=function(a){this.lights.push(a),a.scene=this},b}();a.Scene=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){function b(a){var b=null;try{b=a.getContext("experimental-webgl")}catch(c){b=a.getContext("webgl")}return b||alert("can't init webgl, current browser may not support it."),b}function c(a){if(!a)return null;for(var b="",c=a.firstChild;c;)3==c.nodeType&&(b+=c.textContent),c=c.nextSibling}function d(a,b,c){var d,e;return c==g.FragmentShader?(d=a.createShader(a.FRAGMENT_SHADER),e="fragment shader"):c==g.VertexShader&&(d=a.createShader(a.VERTEX_SHADER),e="vertex shader"),a.shaderSource(d,b),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:(alert("error: "+e+"\n"+a.getShaderInfoLog(d)),null)}function e(a,b,c){var d=a.createProgram();return a.attachShader(d,b),a.attachShader(d,c),a.linkProgram(d),a.getProgramParameter(d,a.LINK_STATUS)||alert("Unable to initialize the shader program.\n"+a.getProgramInfoLog(d)),d}function f(a,b,c){var f=d(a,b,g.VertexShader),h=d(a,c,g.FragmentShader);return e(a,f,h)}!function(a){a[a.VertexShader=0]="VertexShader",a[a.FragmentShader=1]="FragmentShader"}(a.ShaderType||(a.ShaderType={}));var g=a.ShaderType;a.initWebwebglContext=b,a.getDomScriptText=c,a.createEntileShader=f}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(){b.call(this),this.projectionMatrix=a.mat4.create(),console.log(this.projectionMatrix),console.log("init camera")}return __extends(c,b),c}(a.Object3d);a.Camera=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(c){b.call(this),a.mat4.ortho(this.projectionMatrix,-1,1,-1,1,.1,100)}return __extends(c,b),c}(a.Camera);a.OrthoCamera=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(c){b.call(this),this.projectionMatrix=a.mat4.perspective(this.projectionMatrix,45,640/480,.1,100)}return __extends(c,b),c}(a.Camera);a.PerspectiveCamera=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(a){function b(){a.call(this),this.positions=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],this.uvs=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],this.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}return __extends(b,a),b}(a.Geometry);a.CubeGeometry=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(a){function b(){a.call(this),this.positions=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],this.uvs=[0,0,1,0,0,1,1,1],this.normals=[1,0,0,0,1,0,0,0,1,0,1,1],this.indices=[0,1,2,2,1,3]}return __extends(b,a),b}(a.Geometry);a.RectGeomotry=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(a){function b(b,c){a.call(this),this.radius=b,this.perVertDistance=c;for(var d=-b;b>=d;d+=c)for(var e=Math.sqrt(b*b-d*d),f=-e;e>=f;f+=c){var g=Math.sqrt(e*e-f*f),h=-g;this.positions.push(f,d,g),this.positions.push(f,d,h)}for(var i=0,j=this.positions;i<j.length;i++){var k=j[i];console.log(k)}}return __extends(b,a),b}(a.Geometry);a.SphereGeometry=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(){b.call(this),this.diffuse=a.vec3.fromValues(1,1,1),this.specular=a.vec3.fromValues(1,1,1),this.idensity=1}return __extends(c,b),c}(a.Object3d);a.Light=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(a){function b(){a.call(this)}return __extends(b,a),b}(a.Light);a.PointLight=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(){}return b.fetch=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b&&b(c.responseText)},c.open("GET",a),c.send()},b.loadObj=function(c,d){var e=(new RegExp("^(-?d+)(.d+)?$"),new RegExp("v.+")),f=new RegExp("vt.+");b.fetch(c,function(b){var c,d,g;new a.Geometry;c=b.split("\n");for(var h=0,i=c;h<i.length;h++){var j=i[h];j.match(e)&&d.push(j),j.match(f)&&g.push(j)}return g.length>0&&d.length!=g.length?(console.error("obj file format error!"),null):void 0})},b}();a.ModelLoader=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(c){b.call(this),this.vertexShaderSource=a.brdf_pervert_vert,this.fragShaderSource=a.brdf_pervert_frag,void 0!=c.texture&&(this.map=c.texture,this.addAttribute("aTextureCoord",this.map)),void 0!=c.color&&(this.color=c.color,this.addUniform("uColor",this.color))}return __extends(c,b),c}(a.Material);a.BRDFPerVertMaterial=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(b){function c(c){b.call(this),this.vertexShaderSource=a.brdf_perfrag_vert,this.fragShaderSource=a.brdf_perfrag_frag,void 0!=c.texture&&(this.map=c.texture,this.addAttribute("aTextureCoord",this.map)),void 0!=c.color&&(this.color=c.color,this.addUniform("uColor",this.color))}return __extends(c,b),c}(a.Material);a.BRDFPerFragMaterial=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){function b(b){a.engine=new c(b)}a.setCanvas=b;var c=function(){function b(b){this.preloadRes=[],this.textureIndices={},this.usedTextureNum=0,this.vertPrecision="highp",this.fragPrecision="mediump",this.canvasDom=b||document.createElement("canvas"),this.gl=a.initWebwebglContext(b),this.initMatrix(),this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL)}return b.prototype.makeProgram=function(b,c,d){var e=["precision "+this.vertPrecision+" float;",c.material.map?"#define USE_TEXTURE ":"",c.material.color?"#define USE_COLOR ":"",b.openLight?"#define OPEN_LIGHT\n#define LIGHT_NUM "+b.lights.length:""].join("\n")+"\n",f=["precision "+this.fragPrecision+" float;",c.material.map?"#define USE_TEXTURE ":"",c.material.color?"#define USE_COLOR ":"",b.openLight?"#define OPEN_LIGHT \n#define LIGHT_NUM "+b.lights.length:""].join("\n")+"\n";a.debug,c.program=new a.Program,c.program.webGlProgram=a.createEntileShader(this.gl,e+c.material.vertexShaderSource,f+c.material.fragShaderSource),this.gl.useProgram(c.program.webGlProgram),c.program.addUniform("modelViewMatrix",function(){a.engine.gl.uniformMatrix4fv(c.program.uniforms.modelViewMatrix,!1,new Float32Array(c.modelViewMatrix))}),c.program.addUniform("projectionMatrix",function(){a.engine.gl.uniformMatrix4fv(c.program.uniforms.projectionMatrix,!1,new Float32Array(d.projectionMatrix))}),c.program.indexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,c.program.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(c.geometry.indices),c.program.drawMode),c.program.setAttribute0(new a.VertexBuffer("position",3,this.gl.FLOAT)).data=c.geometry.positions,void 0!=c.material.color&&c.program.addUniform("color",function(){a.engine.gl.uniform4f(c.program.uniforms.color,c.material.color[0],c.material.color[1],c.material.color[2],c.material.color[3])}),void 0!=c.material.map&&(c.maps.push(c.material.map),c.program.addAttribute(new a.VertexBuffer("aTextureCoord",2,this.gl.FLOAT)).data=c.geometry.uvs),b.openLight&&(console.log("open light"),this.setUplights(b,c,d)),this.copyToVertexBuffer(c.program)},b.prototype.setUplights=function(b,c,d){var e=this;c.program.addUniform("normalMatrix",function(){a.engine.gl.uniformMatrix4fv(c.program.uniforms.normalMatrix,!1,new Float32Array(c.normalMatrix))}),c.program.addUniform("ambient",function(){a.engine.gl.uniform3f(c.program.uniforms.ambient,b.ambientLight[0],b.ambientLight[1],b.ambientLight[2])}),c.program.addUniform("eyePosition",function(){a.engine.gl.uniform3f(c.program.uniforms.eyePosition,d.position[0],d.position[1],d.position[2])}),c.program.addAttribute(new a.VertexBuffer("aNormal",3,this.gl.FLOAT)).data=c.geometry.normals;for(var f,g,h,i,j=0,k=function(a){f="lights["+j+"].diffuse",g="lights["+j+"].specular",h="lights["+j+"].idensity",i="lights["+j+"].position",c.program.addUniform(f,function(){e.gl.uniform3f(c.program.uniforms[f],a.diffuse[0],a.diffuse[1],a.diffuse[2])}),c.program.addUniform(g,function(){e.gl.uniform3f(c.program.uniforms[g],a.specular[0],a.specular[1],a.specular[2])}),c.program.addUniform(i,function(){e.gl.uniform3f(c.program.uniforms[i],a.position[0],a.position[1],a.position[2])}),c.program.addUniform(h,function(){e.gl.uniform1f(c.program.uniforms[h],a.idensity)})},l=0,m=b.lights;l<m.length;l++){var n=m[l];k(n)}},b.prototype.addTexture=function(a){this.textureIndices[a.image.src]=this.usedTextureNum,this.usedTextureNum++},b.prototype.startRender=function(b,c,d){var e=this;this.gl.clearColor(b.clearColor[0],b.clearColor[1],b.clearColor[2],b.clearColor[3]);for(var f=0,g=b.objects;f<g.length;f++){var h=g[f];if(h instanceof a.Mesh){var i=h;this.makeProgram(b,i,c)}}setInterval(function(){return e.renderImmediately(b,c)},d)},b.prototype.getUniformLocation=function(a,b){if(void 0==this.gl||null==this.gl)return console.error("WebGLRenderingContext has not been initialize!"),null;var c=this.gl.getUniformLocation(a.webGlProgram,b);return null==c?(console.error("uniform "+b+" not found!"),null):c},b.prototype.getAttribLocation=function(a,b){if(void 0==this.gl||null==this.gl)return console.error("WebGLRenderingContext has not been initialize!"),null;var c=this.gl.getAttribLocation(a.webGlProgram,b);return null==c?(console.error("attribute "+b+" not found!"),null):c},b.prototype.enableTexture=function(b,c){var d=a.engine.gl;d.useProgram(b.program.webGlProgram),this.addTexture(c);var e=this.textureIndices[c.image.src];d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,1),d.activeTexture(d.TEXTURE0+e),d.bindTexture(d.TEXTURE_2D,c.glTexture),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c.image),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.MIRRORED_REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.MIRRORED_REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),b.program.addUniform("uTextureSampler",function(){a.engine.gl.uniform1i(b.program.uniforms.uTextureSampler,e)})},b.prototype.copyToVertexBuffer=function(b){var c=a.engine.gl;for(var d in b.vertexBuffers)c.enableVertexAttribArray(b.vertexBuffers[d].index),c.bindBuffer(c.ARRAY_BUFFER,b.vertexBuffers[d].buffer),c.bufferData(c.ARRAY_BUFFER,new Float32Array(b.vertexBuffers[d].data),a.engine.gl.STATIC_DRAW)},b.prototype.renderObject=function(b,c){var d=this.gl;if(c instanceof a.Mesh){var e=c;this.gl.useProgram(e.program.webGlProgram);for(var f in e.program.uniformUpdaters)e.program.uniformUpdaters[f]();for(var g=0,h=e.maps;g<h.length;g++){var i=h[g];i.isReadyToUpdate&&(this.enableTexture(e,i),i.isReadyToUpdate=!1)}for(var j in e.program.vertexBuffers)d.bindBuffer(a.engine.gl.ARRAY_BUFFER,e.program.vertexBuffers[j].buffer),a.engine.gl.vertexAttribPointer(e.program.vertexBuffers[j].index,e.program.vertexBuffers[j].size,e.program.vertexBuffers[j].type,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e.program.indexBuffer),d.drawElements(d.TRIANGLES,e.geometry.indices.length,d.UNSIGNED_SHORT,0)}},b.prototype.renderImmediately=function(a,b){if(!(this.preloadRes.length>0)){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);for(var c=0,d=a.objects;c<d.length;c++){var e=d[c];if(a.openLight)for(var f=0,g=a.objects;f<g.length;f++){g[f]}this.renderObject(b,e)}}},b.prototype.initMatrix=function(){a.glMatrix.setMatrixArrayType(Float32Array)},b}();a.Renderer=c}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){var b=function(){function b(b,c,d,e,f){this.buffer=null,this.name=b,this.size=c,this.type=d,this.data=e?e:[],this.stride=f?f:0,this.buffer=a.engine.gl.createBuffer()}return b}();a.VertexBuffer=b}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){function b(a){}function c(a){}a.vertexShaderTemplate={basic:["common"]},a.fragmentShaderTemplate={basic:["common"]},a.makeVertShader=b,a.makeFragShader=c}(CanvasToy||(CanvasToy={}));var CanvasToy;!function(a){a.basic_frag="#version 100\n\n#ifdef USE_COLOR\nvarying vec4 vColor;\n#endif\n\n#ifdef USE_TEXTURE\nvarying vec2 vTextureCoord;\nuniform sampler2D uTextureSampler;\nvec4 textureColor;\n#endif\n\n#ifdef OPEN_LIGHT\nvarying vec3 vNormal;\n#endif\n\nvoid main() {\n#ifdef USE_COLOR\n    gl_FragColor = vColor;\n#endif\n\n#ifdef USE_TEXTURE\n    gl_FragColor = texture2D(uTextureSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n#endif\n\n}\n",a.basic_vert="#version 100\n\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec4 cameraPosition;\n\n#ifdef USE_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n\n#ifdef USE_TEXTURE\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n#endif\n\n#ifdef OPEN_LIGHT\nattribute vec3 aNormal;\nvarying vec3 vNormal;\n#endif\n\nvoid main (){\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n#ifdef USE_COLOR\n    vColor = aColor;\n#endif\n\n#ifdef USE_TEXTURE\n    vTextureCoord = aTextureCoord;\n#endif\n\n}\n",a.brdf_perfrag_frag="#ifdef USE_COLOR // color declaration\nuniform vec4 color;\n#endif // color declaration\n\n#ifdef USE_TEXTURE // texture declaration\nvarying vec2 vTextureCoord;\nuniform sampler2D uTextureSampler;\nvec4 textureColor;\n#endif // texture declaration\n\n#ifdef OPEN_LIGHT // light declaration\nstruct Light {\n    vec3 specular;\n    vec3 diffuse;\n    float idensity;\n    vec3 position;\n    bool directional;\n};\nuniform vec3 ambient;\nuniform vec3 eyePosition;\nvarying vec3 vPosition;\nvec3 totalLighting;\nuniform Light lights[LIGHT_NUM];\nvarying vec3 vNormal;\n#endif // light declaration\n\nvoid main() {\n#ifdef USE_TEXTURE\n    textureColor = texture2D(uTextureSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n#endif\n#ifdef OPEN_LIGHT\n    totalLighting = ambient;\n    vec3 normal = normalize(vNormal);\n    for (int index = 0; index < LIGHT_NUM; index++) {\n        vec3 lightDir = normalize(lights[index].position - vPosition);\n        float lambortian = max(dot(lightDir, normal), 0.0);\n        vec3 reflectDir = reflect(-lightDir, normal);\n        vec3 viewDir = normalize(eyePosition - vPosition);\n        float specularAngle = max(dot(reflectDir, viewDir), 0.0);\n        float specular = pow(specularAngle, lights[index].idensity);\n        vec3 specularColor = lights[index].specular * specular;\n        vec3 diffuseColor = lights[index].diffuse * lambortian * lights[index].idensity;\n        totalLighting = totalLighting + (diffuseColor + specularColor);\n    }\n    gl_FragColor = vec4(totalLighting, 1.0);\n#endif\n#ifdef USE_TEXTURE\n    gl_FragColor = gl_FragColor * textureColor;\n#endif\n#ifdef USE_COLOR\n    gl_FragColor = gl_FragColor * color;\n#endif\n}\n",a.brdf_perfrag_vert="attribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n#ifdef USE_TEXTURE\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n#endif\n\n#ifdef OPEN_LIGHT\nuniform mat4 normalMatrix;\nattribute vec3 aNormal;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#endif\n\nvoid main (){\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#ifdef OPEN_LIGHT\n    vNormal = (normalMatrix * vec4(aNormal, 0.0)).xyz;\n    vPosition = gl_Position.xyz;\n#endif\n\n#ifdef USE_TEXTURE\n    vTextureCoord = aTextureCoord;\n#endif\n}\n",a.brdf_pervert_frag="#ifdef USE_COLOR // color declaration\nuniform vec4 color;\n#endif // color declaration\n\n#ifdef USE_TEXTURE // texture declaration\nvarying vec2 vTextureCoord;\nuniform sampler2D uTextureSampler;\n#endif // texture declaration\n\n#ifdef OPEN_LIGHT // light declaration\nvarying vec3 vLightColor;\n#endif // light declaration\n\nvoid main() {\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n#ifdef USE_COLOR\n    gl_FragColor = color;\n#endif\n\n#ifdef USE_TEXTURE\n    gl_FragColor = gl_FragColor * texture2D(uTextureSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n#endif\n\n#ifdef OPEN_LIGHT\n    gl_FragColor = gl_FragColor * vec4(vLightColor, 1.0);\n#endif\n}\n",
a.brdf_pervert_vert="attribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n#ifdef USE_TEXTURE // texture\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n#endif // texture\n\n#ifdef OPEN_LIGHT // light\nstruct Light {\n    vec3 specular;\n    vec3 diffuse;\n    float idensity;\n    vec3 position;\n    bool directional;\n}; // light\n\nuniform vec3 ambient;\nuniform vec3 eyePosition;\nuniform mat4 normalMatrix;\nattribute vec3 aNormal;\nvarying vec3 vLightColor;\nvec3 totalLighting;\nuniform Light lights[LIGHT_NUM];\n#endif\n\nvoid main (){\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#ifdef OPEN_LIGHT\n    vec3 normal = (normalMatrix * vec4(aNormal, 0.0)).xyz;\n    totalLighting = ambient;\n    normal = normalize(normal);\n    for (int index = 0; index < LIGHT_NUM; index++) {\n        vec3 lightDir = normalize(lights[index].position - gl_Position.xyz);\n        float lambortian = max(dot(lightDir, normal), 0.0);\n        vec3 reflectDir = reflect(-lightDir, normal);\n        vec3 viewDir = normalize(eyePosition - gl_Position.xyz);\n        float specularAngle = max(dot(reflectDir, viewDir), 0.0);\n        float specular = pow(specularAngle, lights[index].idensity);\n        vec3 specularColor = lights[index].specular * specular;\n        vec3 diffuseColor = lights[index].diffuse * lambortian * lights[index].idensity;\n        totalLighting = totalLighting + (diffuseColor + specularColor);\n    }\n    vLightColor = totalLighting;\n#endif\n#ifdef USE_TEXTURE\n    vTextureCoord = aTextureCoord;\n#endif\n}\n"}(CanvasToy||(CanvasToy={}));